#!/bin/bash

# ๐ธ๐ฆ ููู ุฃุจุดุฑ - ุณูุฑูุจุช ุงูุชุซุจูุช ุงูุณุฑูุน
# Wafi Absher - Quick Installation Script

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ                                                                โ"
echo "โ        ๐ธ๐ฆ ููู ุฃุจุดุฑ - ุณูุฑูุจุช ุงูุชุซุจูุช ุงูุณุฑูุน                   โ"
echo "โ           Wafi Absher - Quick Installation Script              โ"
echo "โ                                                                โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุชุญุฏูุฏ ูุธุงู ุงูุชุดุบูู
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
    OS="linux"
    PYTHON_CMD="python3"
elif [[ "$OSTYPE" == "darwin"* ]]; then
    OS="macos"
    PYTHON_CMD="python3"
elif [[ "$OSTYPE" == "msys" || "$OSTYPE" == "win32" ]]; then
    OS="windows"
    PYTHON_CMD="python"
fi

echo "๐ ูุธุงู ุงูุชุดุบูู ุงูููุชุดู: $OS"
echo ""

# ุงูุฎุทูุฉ 1: ุงูุชุญูู ูู Python
echo "โ ุงูุฎุทูุฉ 1: ุงูุชุญูู ูู Python..."
if ! command -v $PYTHON_CMD &> /dev/null; then
    echo "โ ุฎุทุฃ: Python ุบูุฑ ูุซุจุช"
    echo "   ุงูุฑุฌุงุก ุชุซุจูุช Python 3.10 ุฃู ุฃุญุฏุซ"
    exit 1
fi
PYTHON_VERSION=$($PYTHON_CMD --version)
echo "โ Python $PYTHON_VERSION ููุฌูุฏ"
echo ""

# ุงูุฎุทูุฉ 2: ุฅูุดุงุก ุจูุฆุฉ ุงูุชุฑุงุถูุฉ
echo "โ ุงูุฎุทูุฉ 2: ุฅูุดุงุก ุจูุฆุฉ ุงูุชุฑุงุถูุฉ..."
if [ ! -d "venv" ]; then
    $PYTHON_CMD -m venv venv
    echo "โ ุชู ุฅูุดุงุก ุจูุฆุฉ ุงูุชุฑุงุถูุฉ"
else
    echo "โ ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ููุฌูุฏุฉ"
fi
echo ""

# ุงูุฎุทูุฉ 3: ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ
echo "โ ุงูุฎุทูุฉ 3: ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ..."
if [[ "$OS" == "windows" ]]; then
    source venv/Scripts/activate
else
    source venv/bin/activate
fi
echo "โ ุชู ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ"
echo ""

# ุงูุฎุทูุฉ 4: ุชุซุจูุช ุงูููุชุจุงุช
echo "โ ุงูุฎุทูุฉ 4: ุชุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ..."
pip install --upgrade pip
pip install -r requirements.txt
echo "โ ุชู ุชุซุจูุช ุฌููุน ุงูููุชุจุงุช"
echo ""

# ุงูุฎุทูุฉ 5: ุงูุชุญูู ูู ุงูุจูุงูุงุช
echo "โ ุงูุฎุทูุฉ 5: ุงูุชุญูู ูู ุจูุงูุงุช ุงููุณุชุฎุฏููู..."
if [ -f "synthetic_users_1000-2.json" ]; then
    FILE_SIZE=$(wc -c < synthetic_users_1000-2.json)
    FILE_SIZE_MB=$(echo "scale=2; $FILE_SIZE / 1048576" | bc)
    echo "โ ููู ุงูุจูุงูุงุช ููุฌูุฏ ($FILE_SIZE_MB MB)"
else
    echo "โ๏ธ  ุชุญุฐูุฑ: ููู synthetic_users_1000-2.json ูู ูุชู ุงูุนุซูุฑ ุนููู"
    echo "   ูุฏ ูููู ุงูุชุทุจูู ูุญุชุงุฌ ุฅูู ูุฐุง ุงูููู"
fi
echo ""

# ุงูุฎุทูุฉ 6: ุงูุชุดุบูู
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ                                                                โ"
echo "โ                   โ ุงูุชุซุจูุช ุงูุชูู ุจูุฌุงุญ!                    โ"
echo "โ                                                                โ"
echo "โ           ูุชุดุบูู ุงูุชุทุจููุ ุงุณุชุฎุฏู ุงูุฃูุฑ ุงูุชุงูู:                โ"
echo "โ                                                                โ"
echo "โ      streamlit run wafi-absher-v003.py                        โ"
echo "โ                                                                โ"
echo "โ                ุฃู ุงุถุบุท ุนูู ุงูุฒุฑ ุฃุฏูุงู...                      โ"
echo "โ                                                                โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ุงูุณุคุงู ุนูุง ุฅุฐุง ูุงู ูุฑูุฏ ุชุดุบูู ุงูุชุทุจูู ุงูุขู
read -p "ูู ุชุฑูุฏ ุชุดุบูู ุงูุชุทุจูู ุงูุขูุ (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo ""
    echo "๐ ุชุดุบูู ุงูุชุทุจูู..."
    echo ""
    streamlit run wafi-absher-v003.py
else
    echo ""
    echo "โ ุชู. ููููู ุชุดุบูู ุงูุชุทุจูู ูุงุญูุงู ุจุงุณุชุฎุฏุงู:"
    echo "   streamlit run wafi-absher-v003.py"
    echo ""
fi
